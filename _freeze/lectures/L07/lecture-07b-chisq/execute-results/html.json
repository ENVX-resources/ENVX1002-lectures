{
  "hash": "2bcb68a682b061c11a2dc0c12cb81d51",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Topic 7 -- Chi-squared tests\nauthor: Januar Harianto\nformat: soles-revealjs\nembed-resources: true\n---\n\n\n\n\n\n\n# Recap\n\n## Parametric and non-parametric alternatives\n\n::: incremental\n- So far, **all** of our techniques have been aimed at comparing **means/medians** of continuous variables.\n- The *assumption of normality* **underpins** these techniques -- if the data is not normally distributed, we have alternatives like *transforming* the data or using *non-parametric tests*.\n- **Does this apply to all data?**\n:::\n\n## A rational assumption?\n\n::: incremental\n- **Are all randomly sampled data normally distributed?**\n- Recall probability distributions (Week 3) -- **normal distribution** is just *one of several* possible distributions of data.\n- It turns out that there are non-parametric techniques that are not just *alternatives* of parametric tests, but **better suited** for certain types of data.\n:::\n\n\n# Categorical data\nSome data are not measured on a continuous scale, but rather as **categories**. \n\n## What are categorical variables?\n\nConsider the following questions:\n\n::: fragment\n\n> A biologist claims that when sampling the Australian Botanical Gardens for butterflies, the ratio of the most dominant colours (red, blue, green, and yellow) is equal. How would you determine if the biologist's claim is true?\n\n> A study was conducted on a population of deer to see if there is a relationship between their age group (young, adult, old) and their preferred type of vegetation (grass, leaves, bark). Is age group of the deer independent of their vegetation preference?\n:::\n\n::: fragment\nHow would you **measure** these variables, and what sort of summary statistics can you use?\n\n:::\n\n\n## Visualising categorical variables\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lecture-07b-chisq_files/figure-revealjs/unnamed-chunk-1-1.png){width=960}\n:::\n:::\n\n\n\n\nWe can only **count** the number of times a particular category occurs, or the **proportion** of the total that each category represents.\n\n## Types of categorical data\n\n- Rather than measuring a continuous variable, we are interested in **counting** the number of times a particular category occurs, or the **proportion** of the total that each category represents.\n- These are known as **categorical variables**.\n- Generally 3 types of categorical data:\n  - **Nominal**: Categories have no inherent order (e.g. colours, breeds of dogs).\n  - **Ordinal**: Categories have an inherent order (e.g. Likert scales, grades).\n  - **Binary**: Only two mutually exclusive categories (e.g rain or no rain).\n  \n# Chi-squared distribution\n\n## The chi-squared test\n\n- The chi-squared test is perhaps one of the most prominent examples of non-parametric tests.\n- Developed by Karl Pearson in 1900, pronounced \"ki\" as in \"kite\", uses the Greek letter $\\chi$.\n- Actually derived from the normal distribution: a chi-squared distribution is the sum of squared standard normal deviates -- essentially a **folded-over** and **stretched out** normal.\n\n## Chi-squared distribution vs normal distribution\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lecture-07b-chisq_files/figure-revealjs/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n\n\n\nHow is the chi-squared distribution used in hypothesis testing?\n\n## Butterflies data\n\n> A biologist claims that when sampling the Australian Botanical Gardens for butterflies, the ratio of the most dominant colours (red, blue, green, and yellow) is equal. How would you determine if the biologist's claim is true?\n\nSuppose we have the following data on the colours of butterflies after randomly sampling 200 of them:\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|color  | count|\n|:------|-----:|\n|red    |    48|\n|blue   |    62|\n|green  |    56|\n|yellow |    34|\n\n\n:::\n:::\n\n\n\n\n## Testing the claim\n\n- If the biologist's claim is true, we would expect the number of butterflies of each colour to be equal.\n- If 200 butterflies were sampled, we would expect 50 of each colour, as the expected frequency of each colour is 200 $\\times$ 0.25 = 50.\n\n\nTherefore:\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|color  | count| expected|\n|:------|-----:|--------:|\n|red    |    48|       50|\n|blue   |    62|       50|\n|green  |    56|       50|\n|yellow |    34|       50|\n\n\n:::\n:::\n\n\n\n\n## Test statistic\n\nThe **test statistic** for the chi-squared test is calculated as:\n\n$$ \\chi^2 = \\sum \\frac{(O - E)^2}{E} $$\n\nwhere $O$ is the observed frequency and $E$ is the expected frequency.\n\n. . .\n\nSo for the butterfly data:\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 8.8\n```\n\n\n:::\n:::\n\n\n\n\nThis is the test statistic for one sample. How do we interpret this value?\n\n## Simulate the null distribution\n\nUnder the null hypothesis, the observed frequencies are equal to the expected frequencies i.e. the biologist's claim is true.\n\nSuppose we repeat the sampling process many times, **assuming the null hypothesis is true**, each time calculating the test statistic. What would the distribution of test statistics look like?\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lecture-07b-chisq_files/figure-revealjs/unnamed-chunk-6-1.png){width=1536}\n:::\n:::\n\n\n\n\n## What does our test statistic tell us?\n\n::: fragment\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lecture-07b-chisq_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.034\n```\n\n\n:::\n:::\n\n\n\n\nComparing our test statistic to the simulated distribution, we can see that the 0.03% of the simulated values are greater than our test statistic. **What does this tell us?**\n:::\n\n## A $\\chi^2$ test\n\nA chi-squared distribution allows us to perform the same hypothesis test without the need for simulation.\n\n. . .\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lecture-07b-chisq_files/figure-revealjs/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n\n\n## Conclusion?\n\nThe results of the simulation suggest that the observed frequencies of butterfly colours are **significantly different** from the expected frequencies, and we can **reject** the biologist's claim.\n\n## More on the chi-squared distribution\n\n- The chi-squared distribution is **non-symmetric** and **right-skewed**.\n- The shape of the distribution is determined by the **degrees of freedom**, calculated as the number of categories minus 1.\n- As the degrees of freedom increase, the chi-squared distribution approaches a normal distribution due to the **central limit theorem**.\n\n---\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lecture-07b-chisq_files/figure-revealjs/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\n\n\n# The Chi-squared test\n\n## Definitions\n\n- **Chi-squared distribution**: a distribution derived from the normal distribution\nthat allows us to determine whether the observed frequencies of a categorical variable differ from the expected frequencies.\n- **Contingency table**: a table that displays the frequency of observations for two or more categorical variables.\n- **Expected frequency**: the frequency that we would expect to observe if the null hypothesis is true.\n- **Observed frequency**: the frequency that we actually observe.\n- **Test statistic**: a **measure** of how much the observed frequencies differ from the expected frequencies, standardised by the expected frequencies.\n\n\n## Types of chi-squared tests\n\n- **Goodness-of-fit test**: used to determine whether the observed frequencies of a categorical variable differ from the expected frequencies.\n- **Test of independence**: used to determine whether there is a relationship between two or more categorical variables.\n- **Test of homogeneity**: used to determine whether the distribution of a categorical variable is the same across different groups.\n\n## Assumptions\n\n- The chi-squared test is a **non-parametric** test, so it does not rely on the assumption of normality. However, it does have some assumptions:\n  - **Independence**: the observations are independent.\n  - **Sample size**: the expected frequency of each category is at least 1, and no more than 20% of the expected frequencies are less than 5.\n  \nThe sample size assumption ensures that the chi-squared distribution is a good approximation of the normal distribution.\n\n# Example: Goodness of fit\n\n> A biologist claims that when sampling the Australian Botanical Gardens for butterflies, the ratio of the most dominant colours (red, blue, green, and yellow) is equal. How would you determine if the biologist's claim is true?\n\n## Hypothesis\n\n- **Null hypothesis**: the observed proportion of butterfly colours are equal to the expected proportions of 0.25 each.\n- **Alternative hypothesis**: the observed proportions are not equal.\n\n$$ H_0: p_1 = p_2 = p_3 = p_4 = 0.25 $$\n$$ H_1: \\text{at least one } p_i \\neq 0.25 $$\n\n## Test statistic and check assumptions (in R)\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n**Assumptions**\n\nBy performing the chi-squared test, we can check the assumptions of the test by looking at the calculated frequences in the output:\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 48 62 56 34\n```\n\n\n:::\n:::\n\n\n\n\n**Test statistic**\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tChi-squared test for given probabilities\n\ndata:  df$count\nX-squared = 8.8, df = 3, p-value = 0.03207\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Conclusion\n\nThe results of the chi-squared test suggest that the observed frequencies of butterfly colours are **significantly different** from the expected frequencies ($\\chi^2 = 8.8$, $df = 3$, $p < 0.001$). We can reject the null hypothesis and conclude that the biologist's claim is not true.\n\n::: callout-note\nIf you're interested, compare this result to the simulation we performed earlier.\n:::\n\n# Example: Test of independence\n\n> A study was conducted on a population of deer to see if there is a relationship between their age group (young, adult, old) and their preferred type of vegetation (grass, leaves, bark). Is age group of the deer independent of their vegetation preference?\n\n## Hypothesis\n\n- **Null hypothesis**: the age group of the deer is independent of their vegetation preference.\n- **Alternative hypothesis**: the age group of the deer is not independent of their vegetation preference.\n\n$$ H_0: \\text{Age group is independent of vegetation preference} $$\n\n> No relationship between the two variables\n\n$$ H_1: \\text{Age group is not independent of vegetation preference} $$\n\n> There is a relationship between the two variables\n\n## Data\n\nSuppose we have the following data on the age group and vegetation preference of 100 deer:\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n      grass leaves bark\nyoung    20     30   10\nadult    10     10   20\nold      10     10   10\n```\n\n\n:::\n:::\n\n\n\n\n\n## Test statistic and check assumptions (in R)\n\n**Assumptions** are met as we can see the contingency table in the previous slide.\n\n### Test statistic\n<br>\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's Chi-squared test\n\ndata:  deer_data\nX-squared = 13.542, df = 4, p-value = 0.008911\n```\n\n\n:::\n:::\n\n\n\n\nWe reject the null hypothesis since the p-value is less than 0.05.\n\n## Conclusion\n\nThe results of the chi-squared test suggest that the age group of the deer is **not independent** of their vegetation preference ($\\chi^2 = 12.4$, $df = 4$, $p < 0.001$). We can reject the null hypothesis and conclude that there is a relationship between the age group of the deer and their vegetation preference.\n\n# How do we visualise the differences in a contingency table?\n\n## Mosaic plots\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lecture-07b-chisq_files/figure-revealjs/unnamed-chunk-16-1.png){width=960}\n:::\n:::\n\n\n\n\n## Interpretation\n\n- The area of each rectangle is proportional to the number of observations in that category.\n- The **shading** of each rectangle indicates the **expected** frequency of observations in that category.\n- The **darker** the shading, the **greater** the difference between the observed and expected frequencies.\n- Dotted lines indicate **independence** between the two variables.\n- Solid lines indicate **dependence** between the two variables.\n\n## Association plots\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lecture-07b-chisq_files/figure-revealjs/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n\n\n\n## Interpretation\n\n- Size of cells indicate the number of observations in that category.\n- The shadings are made based on the residuals of the chi-squared test (see legend), highlighting which cells contribute most to the chi-squared statistic.\n- Colour of the shadings indicate whether they are more or less frequent than expected (again, see legend).\n\n# What about the test of homogeneity?\n\n## Test of homogeneity vs. test of independence\n\n- The **test of homogeneity** is similar to the **test of independence**, but is used when we have **two or more groups** and we want to determine whether the distribution of a categorical variable is the same across different groups.\n- In general, this means that the null hypothesis is stated differently, and the test statistic is calculated in a slightly different way with different degrees of freedom.\n- Homogeneity\n  - $H_0$: The distribution of the categorical variable is the same across different groups.\n  - $H_1$: The distribution of the categorical variable is not the same across different groups.\n- Independence\n  - $H_0$: The variables of interest are independent.\n  - $H_1$: The variables of interest are not independent.\n  \n\n## Differences are subtle\n\n- In the test of independence, observational units are collected at random from **a single population** and two (or more) categorical variables are observed for each unit.\n- For the deer example, the experimental design would involve randomly sampling deer and recording their age group and vegetation preference.\n\n> Is age group independent of vegetation preference?\n\n- In the test of homogeneity, the data are collected by randomly sampling from **two or more subgroups**, and the same categorical variable is observed for each unit.\n- For the deer example, the experimental design would have to be modified to sample the vegetation preference of deer from young, adult, and old populations.\n\n> Is the distribution of vegetation preference the same if we compare young, adult, and old deer?\n\n# Summary\n\n## When to use a chi-squared test?\n\n- The chi-squared test is not an \"alternative\" to a parametric test, but is **better suited** for certain types of data and requires delibarate experimental design that collects data in a certain way.\n- If we have **categorical data** and we want to determine whether the observed frequencies differ from the expected frequencies, then we can use a **chi-squared test**.\n- \n\n\n\n\n<!-- ## Willows -->\n\n<!-- The diamond leaf willow (*Salix pulcha*) and the Arctic willow (*Salix arctica*) are both found on rocky outcrops in marshy ground in the Arctic tundra. Does the presence of one species affect the presence of the other? -->\n\n<!-- ::: {layout-ncol=2} -->\n<!-- ![*Salix pulcha*. From Wikipedia.](images/salix_pulcha.jpg){#fig-salix_pulcha} -->\n\n<!-- ![*Salix arcica*. From Wikipedia.](images/salix_arctica.jpg){#fig-salix_arctica} -->\n<!-- ::: -->\n\n\n# Thanks!\n\nThis presentation is based on the [SOLES Quarto reveal.js template](https://github.com/usyd-soles-edu/soles-revealjs) and is licensed under a [Creative Commons Attribution 4.0 International License](http://creativecommons.org/licenses/by/4.0/).\n\n<!-- Links -->\n",
    "supporting": [
      "lecture-07b-chisq_files/figure-revealjs"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}